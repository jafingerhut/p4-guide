digraph p4_dependencies {

    node [shape = box];

    // My hack for providing a kind of 'legend' for the drawing.
    // There is likely a better way than this.
    legen [label="Legend:\nSolid arcs are depdendencies according to install instructions.\nDashed arcs represent git submodules, where the 'to' project is auto-installed\nif you run 'git clone --recursive' on the 'from' project.\nDashed arcs from p4factory not shown in this chart to make the other dependencies clearer." style=bold];

    // All nodes, with labels, for p4lang repositories
    behavioral_model [label="behavioral-model\n(aka bmv2)"];
    mininet [label="mininet"];
    ntf [label="ntf\n(needs root\nprivileges)"];
    p4_build [label="p4-build"];
    p4_hlir [label="p4-hlir"];
    p4app [label="p4app"];
    p4c [label="p4c"];
    p4c_behavioral [label="p4c-behavioral"];
    p4c_bm [label="p4c-bm"];
    p4factory [label="p4factory"];
    p4ofagent [label="p4ofagent"];
    papers [label="papers"];
    PI [label="PI"];
    ptf [label="ptf\n(needs root\nprivileges)"];
    SAI [label="SAI"];
    scapy_vxlan [label="scapy-vxlan\n(recommended\nfor additional\nheaders like\nVXLAN, ERSPAN,\nGENEVE, MPLS, NVGRE)"];
    switch [label="switch"];
    third_party [label="third-party"];
    thrift [label="thrift"];
    tutorials [label="tutorials"];

    // All nodes, with labels, for non-p4lang repositories
    grpc [label="github.com/\ngrpc/grpc"];
    nanomsg [label="github.com/\nnanomsg/nanomsg"];
    nnpy [label="github.com/\nnanomsg/nnpy"];
    protobuf [label="github.com/\ngoogle/protobuf"];
    googlemock_for_protobuf [label="github.com/\ngoogle/googlemock"];
    googletest_for_protobuf [label="github.com/\ngoogle/googletest"];
    floodlight_oftest [label="github.com/\nfloodlight/oftest"];
    floodlight_indigo [label="github.com/\nfloodlight/indigo"];
    floodlight_bigcode [label="github.com/\nfloodlight/bigcode"];
    floodlight_infra [label="github.com/\nfloodlight/infra"];
    floodlight_loxigen_artifacts [label="github.com/\nfloodlight/loxigen-artifacts"];
    googleapis [label="github.com/\ngoogleapis/googleapis"];
    googleapis [label="github.com/\ngoogle/googletest"];
    davidjamesca_ctypesgen [label="github.com/\ndavidjamesca/ctypesgen"];


    ////////////////////////////////////////////////////////////////
    // Dependencies
    ////////////////////////////////////////////////////////////////

    behavioral_model -> thrift;
    behavioral_model -> nanomsg;
    behavioral_model -> nnpy [label="needed if\nyou use\nthe CLI"];

    ntf -> mininet;

    p4_build -> behavioral_model;
    p4_build -> p4c_bm;

    p4c -> PI [label="control-plane/\nPI" style=dashed];

    PI -> googleapis [label="proto/\ngoogleapis" style=dashed];
    PI -> googletest [label="third_party/\ngoogletest" style=dashed];

    p4c_behavioral -> p4_hlir;

//    p4factory -> behavioral_model [label="submodules/\nbm" style=dashed];
//    p4factory -> floodlight_oftest [label="submodules/\noftest" style=dashed];
//    p4factory -> p4_build [label="submodules/\np4-build" style=dashed];
//    p4factory -> p4c_behavioral [label="submodules/\np4c-behavioral" style=dashed];
//    p4factory -> p4c_bm [label="submodules/\np4c-bm" style=dashed];
//    p4factory -> p4ofagent [label="submodules/\np4ofagent" style=dashed];
//    p4factory -> ptf [label="submodules/\nptf" style=dashed];
//    p4factory -> switch [label="submodules/\nswitch" style=dashed];

    p4ofagent -> p4c_behavioral [label="depends on\nPD API\ngenerated by"];
    p4ofagent -> floodlight_indigo [label="submodules/\nindigo" style=dashed];

    floodlight_indigo -> floodlight_bigcode [label="submodules/\nbigcode" style=dashed];
    floodlight_indigo -> floodlight_infra [label="submodules/\ninfra" style=dashed];
    floodlight_indigo -> floodlight_loxigen_artifacts [label="submodules/\nloxigen-artifacts" style=dashed];
    
    floodlight_bigcode -> floodlight_infra [label="submodules/\ninfra" style=dashed];

    ptf -> scapy_vxlan;

    SAI -> ptf [label="test/\nptf" style=dashed];
    SAI -> davidjamesca_ctypesgen [label="test/saithrift/\nctypesgen" style=dashed];

    switch -> p4_build [label="p4-build" style=dashed];
    switch -> SAI [label="switchsai/\nsubmodules/SAI" style=dashed];

    third_party -> grpc [label="grpc" style=dashed];
    third_party -> nanomsg [label="nanomsg" style=dashed];
    third_party -> nnpy [label="nnpy" style=dashed];
    third_party -> protobuf [label="protobuf" style=dashed];
    third_party -> googlemock_for_protobuf [label="protobuf-deps/\ngooglemock" style=dashed];
    third_party -> googletest_for_protobuf [label="protobuf-deps/\ngoogletest" style=dashed];
    third_party -> thrift [label="thrift" style=dashed];

    tutorials -> behavioral_model;
    tutorials -> p4c_bm;
}
